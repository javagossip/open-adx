# ===================================================================
# Jasypt 安全加密配置 (用于保护 Kafka 密码)
# ===================================================================
# 建议通过环境变量 JASYPT_ENCRYPTOR_PASSWORD 注入，避免密钥泄露在代码库中
#jasypt.encryptor.password=${JASYPT_ENCRYPTOR_PASSWORD}

# ===================================================================
# Spring Kafka 基础连接配置
# ===================================================================
# 已经替换为您提供的公网 IP 地址
spring.kafka.bootstrap-servers=101.126.128.177:9092

# -------------------------------------------------------------------
# SASL/PLAIN 安全认证配置 (必须与 Docker 端的 jaas.conf 匹配)
# -------------------------------------------------------------------
spring.kafka.properties.security.protocol=SASL_PLAINTEXT
spring.kafka.properties.sasl.mechanism=PLAIN

# 注意：username 必须是 jaas.conf 中 user_ 后面的名字
# password 建议使用 Jasypt 加密后的 ENC(...) 密文
spring.kafka.properties.sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required \
    username="oax" \
    password="ENC(UW4SzU2fO1/iwzN0KWfAw4EMSRr1qCFH/P8lodtkkzQ=)";

# -------------------------------------------------------------------
# Producer (生产者) 配置 - 适用于广告投放数据写入
# -------------------------------------------------------------------
# acks=all 确保数据在所有副本上都写入成功，保证数据不丢失
spring.kafka.producer.acks=all
spring.kafka.producer.retries=3
# 消息 Key 和 Value 的序列化类
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.apache.kafka.common.serialization.StringSerializer
# 提升吞吐量的批处理配置
spring.kafka.producer.batch-size=16384
spring.kafka.producer.buffer-memory=33554432

# -------------------------------------------------------------------
# Consumer (消费者) 配置 - 适用于广告统计分析
# -------------------------------------------------------------------
# 消费者组 ID
spring.kafka.consumer.group-id=openad-analytics-group
# 首次启动或偏移量失效时，从最早的消息开始消费
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.apache.kafka.common.serialization.StringDeserializer
# 关闭自动提交，手动控制消费确认，防止漏消费
spring.kafka.consumer.enable-auto-commit=false

# -------------------------------------------------------------------
# Listener (监听器) 配置
# -------------------------------------------------------------------
# manual_immediate: 消费完一条立即手动提交
spring.kafka.listener.ack-mode=manual_immediate
# 消费者并发数，建议与 Topic 的分区数保持一致
spring.kafka.listener.concurrency=3