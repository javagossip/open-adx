**iwanvi-媒体流量接入指南**

**V1.0**

  ------------------ -----------------------------------------------------
  **模块名称**       iwanvi-媒体流量接入指南

  **所属系统**       中文万维NVWA系统

  **模块负责人**     史连俊

  **项目负责人**     史连俊

  **文档提交日期**   2019-02-19
  ------------------ -----------------------------------------------------

**修改记录**

  -------- ------------------ ------------------------------ -------------- ------------
   **No**  **修改后版本号**   **修改内容简介**                **修改日期**   **修改人**

     1     V1.0               全文初稿                         2019/02/19      史连俊
  -------- ------------------ ------------------------------ -------------- ------------

# 目录 {#目录 .TOC-Heading}

[接口定义 [4](#接口定义)](#接口定义)

[消息定义 [4](#消息定义)](#消息定义)

[1.Request [4](#request)](#request)

[1.1 request对象 [4](#request对象)](#request对象)

[1.2 imp对象 [4](#imp对象)](#imp对象)

[1.2.1 imp.ext对象 [5](#_Toc1568636)](#_Toc1568636)

[1.3 app对象 [5](#app对象)](#app对象)

[1.4 device对象 [5](#device对象)](#device对象)

[1.5 site对象 [6](#site对象)](#site对象)

[1.6 request示例: [6](#request示例)](#request示例)

[2 Response [7](#response)](#response)

[2.1 response对象 [7](#response对象)](#response对象)

[2.2 ads对象 [7](#ad对象)](#ad对象)

[2.3 native对象 [8](#feed对象)](#feed对象)

[2.4 response示例 [8](#response示例)](#response示例)

[附录 [9](#附录)](#附录)

[设备联网方式 [9](#设备联网方式)](#设备联网方式)

[设备类型 [9](#设备类型)](#设备类型)

# 接口定义

> 媒体广告请求使用http
> post方式进行交互，请求消息格式为JSON，访问超时设置为
> 800ms，开启keep-alive，Content-Type 设为
> application/json，字符编码为utf-8

# 消息定义

## 1.Request

### 1.1 request对象

  -----------------------------------------------------------------------------
  **字段名称**    **类型**     **是否必须**   **说明**
  --------------- ------------ -------------- ---------------------------------
  id              string       Y              request的唯一id

  imps            array        Y              曝光对象，一次请求可包含多个imp

  app             object       Y              媒体信息

  device          object       Y              设备信息

  site            object       N              当请求由浏览器发起时提供
  -----------------------------------------------------------------------------

### 1.2 imp对象

  ----------------------------------------------------------------------------
  **字段名称**    **类型**     **是否必须**   **说明**
  --------------- ------------ -------------- --------------------------------
  id              string       Y              imp的唯一id

  posId           string       Y              广告位标示（由iwanvi线下提供）

  ext             object       N              扩展字段
  ----------------------------------------------------------------------------

### 1.3 app对象

  -------------------------------------------------------------------------
  **字段名称**    **类型**     **是否必须**   **说明**
  --------------- ------------ -------------- -----------------------------
  appId           string       Y              APP标示（由iwanvi线下提供）

  name            string       N              APP名称

  version         string       N              APP版本号

  channel         string       N              APP渠道号

  ext             jsonObject   N              扩展字段，比如书目类别
  -------------------------------------------------------------------------

### 1.4 device对象

+:--------------:+:----------------------------------------------------:+:------------:+:--------------------------------------------------------------------:+
| **字段名称**   | **类型**                                             | **是否必须** | **说明**                                                             |
+----------------+------------------------------------------------------+--------------+----------------------------------------------------------------------+
| did            | ![](media/image1.png){width="9.027777777777777e-3in" | Y            | ![](media/image1.png){width="9.027777777777777e-3in"                 |
|                | height="9.027777777777777e-3in"}string               |              | height="9.027777777777777e-3in"}IMEI(Android)、IDFA(iOS)、Cookie(PC) |
+----------------+------------------------------------------------------+--------------+----------------------------------------------------------------------+
| ip             | string                                               | Y            | 客户端IP地址                                                         |
+----------------+------------------------------------------------------+--------------+----------------------------------------------------------------------+
| carrier        | ![](media/image1.png){width="9.027777777777777e-3in" | N            | ![](media/image1.png){width="9.027777777777777e-3in"                 |
|                | height="9.027777777777777e-3in"}integer              |              | height="9.027777777777777e-3in"}运营商，1:移动; 2:联通; 3:电信;      |
|                |                                                      |              | 0:未知                                                               |
+----------------+------------------------------------------------------+--------------+----------------------------------------------------------------------+
| make           | ![](media/image1.png){width="9.027777777777777e-3in" | N            | ![](media/image1.png){width="9.027777777777777e-3in"                 |
|                | height="9.027777777777777e-3in"}string               |              | height="9.027777777777777e-3in"}设备制造商                           |
+----------------+------------------------------------------------------+--------------+----------------------------------------------------------------------+
| model          | ![](media/image1.png){width="9.027777777777777e-3in" | N            | ![](media/image1.png){width="9.027777777777777e-3in"                 |
|                | height="9.027777777777777e-3in"}string               |              | height="9.027777777777777e-3in"}设备型号                             |
+----------------+------------------------------------------------------+--------------+----------------------------------------------------------------------+
| os             | ![](media/image1.png){width="9.027777777777777e-3in" | Y            | ![](media/image1.png){width="9.027777777777777e-3in"                 |
|                | height="9.027777777777777e-3in"}integer              |              | height="9.027777777777777e-3in"}操作系统                             |
|                |                                                      |              |                                                                      |
|                |                                                      |              | 1:iOS,2:Android,0:其他                                               |
+----------------+------------------------------------------------------+--------------+----------------------------------------------------------------------+
| osv            | string                                               | N            | 操作系统版本号                                                       |
+----------------+------------------------------------------------------+--------------+----------------------------------------------------------------------+
| connectionType | integer                                              | Y            | 设备联网方式，见附录                                                 |
+----------------+------------------------------------------------------+--------------+----------------------------------------------------------------------+
| deviceType     | ![](media/image1.png){width="9.027777777777777e-3in" | Y            | ![](media/image1.png){width="9.027777777777777e-3in"                 |
|                | height="9.027777777777777e-3in"}integer              |              | height="9.027777777777777e-3in"}设备类型，见附录                     |
+----------------+------------------------------------------------------+--------------+----------------------------------------------------------------------+

### 1.5 site对象

  --------------- ------------ -------------- ------------------------------
   **字段名称**     **类型**    **是否必须**             **说明**

       name          string          Y                   站点名称

       page          string          Y                 当前页面Url

        ref          string          Y                 ReferrerUrl
  --------------- ------------ -------------- ------------------------------

### 1.6 request示例: 

> {
>
> \"id\": \"1440645700531182\",
>
> \"app\": {
>
> \"appId\": \"M7nuyi\",
>
> \"name\": \"iwanvi\",
>
> \"version\": \"12.01\",
>
> \"channel\": \"100098\",
>
> \"ext\": {
>
> \"lev1\": 13,
>
> \"lev2\": 889,
>
> \"lev3\": 2
>
> }
>
> },
>
> \"imps\": \[{
>
> "id\": \"12ewe5jsaslgpuqwer\",
>
> \"posId\": \"001\",
>
> "ext": {
>
> "dx_channel": "1"
>
> }
>
> }\],
>
> \"device\": {
>
> \"id": "110255157105",
>
> \"ip": "110.255.157.105",
>
> \"did": "123456789012345",
>
> \"carrier": 0,
>
> \"make": "uawei",
>
> \"model": "p20",
>
> \"os": 2,
>
> \"osv\": \"8.1.3",
>
> \"connectionType\": 1,
>
> \"deviceType\": 3
>
> }
>
> }

## 2 Response

> 正常响应返回的http状态码为200，不出广告则为
> 204。其他情况当做出错处理，如 403 forbidden 或 500 internal server
> error。

### 2.1 response对象

  --------------- ------------ -------------- -----------------------------
   **字段名称**     **类型**    **是否必须**            **说明**

        id           string          Y                 request的id

        ads          array           Y                  广告信息

      source          int            Y              广告来源，见附录
  --------------- ------------ -------------- -----------------------------

### 2.2 ad对象

  --------------- ------------ -------------- -----------------------------
   **字段名称**     **类型**    **是否必须**            **说明**

       impId         string          Y               请求中的imp的id

       posId         string          Y                  广告位ID

        cid           int            Y                 广告物料ID

        img          string                    图片物料地址，图片广告必填

       video         string                    视频物料地址，视频广告必填

        pm           array           Y           曝光监测地址（支持宏）

        cm           array           Y           点击监测地址（支持宏）

        ldp          string          Y                 落地页地址

       feed          object                          信息流广告必填
  --------------- ------------ -------------- -----------------------------

### 2.3 feed对象

  --------------------------------------------------------------------------
  **字段名称**     **类型**    **是否必须**   **说明**
  ---------------- ----------- -------------- ------------------------------
  name             string      Y              名称

  title            string      Y              标题

  portrait         string      Y              头图

  button           string      Y              按钮文案

  imgs             array       Y              广告图片物料地址

  desc             string      Y              描述
  --------------------------------------------------------------------------

### 2.4 response示例

> {
>
> \"ads\": \[{
>
> \"impId\": \"12ewe5jsaslgpuqwer\",
>
> \"posId\": \"001\",
>
> \"cid\": 1,
>
> \"img\": \"http://xxx.xxx.xxx/xxx.xxx\",
>
> \"video\": \"http://xxx.xxx.xxx/xxx.xxx\",
>
> \"ldp\": \"http://xxx.xxx.xxx/xxx.xxx\",
>
> \"pm\": \[\"http://xxx.xxx.xxx/xxx.xxx\",
>
> http://xxx.xxx.xxx/xxx.xxx\"
>
> \],
>
> \"cm\": \[\"http://xxx.xxx.xxx/xxx.xxx\",
>
> http://xxx.xxx.xxx/xxx.xxx\"
>
> \]
>
> }\],
>
> \"source\":0,
>
> \"id\": \"1440645700531182\"
>
> }

# 附录

## 设备联网方式

  ------------ --------------------------------------------------
     **值**                         **说明**

       0                              未知

       1                              wifi

       2                          蜂窝数据-2G

       3                          蜂窝数据-3G

       4                          蜂窝数据-4G
  ------------ --------------------------------------------------

## 设备类型

  ------------ --------------------------------------------------
     **值**                         **说明**

       0                              未知

       1                             Phone

       2                              Pad

       3                               PC

       4                               TV
  ------------ --------------------------------------------------

## 广告来源

  ------------ --------------------------------------------------
     **值**                         **说明**

       0                            中文万维

       1                             广点通

       2                              百度

       3                              360

       4                              头条
  ------------ --------------------------------------------------
